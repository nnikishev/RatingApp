<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:RatingApp.Converters"
             x:Class="RatingApp.Views.RatingFormPage"
             Title="{Binding Title}">
    
    <ContentPage.Resources>
        <converters:RatingToColorConverter x:Key="RatingToColorConverter"/>
        <converters:EditSaveConverter x:Key="EditSaveConverter"/>
    </ContentPage.Resources>
    
    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="15">
            
            <!-- Header -->
            <Label Text="{Binding Title}" 
                   FontSize="24" 
                   FontAttributes="Bold" 
                   HorizontalOptions="Center" 
                   TextColor="#FF3E3EB"/>
            
            <!-- Form Container -->
            <Frame BackgroundColor="#F8F9FA" 
                   BorderColor="#E9ECEF" 
                   CornerRadius="10" 
                   Padding="20">
                
                <VerticalStackLayout Spacing="15">
                    
                    <!-- Name Field -->
                    <VerticalStackLayout Spacing="5">
                        <Label Text="Name *" 
                               FontSize="14" 
                               FontAttributes="Bold" 
                               TextColor="#495057"/>
                        <Entry Text="{Binding Item.Name}" 
                               Placeholder="Enter item name"
                               BackgroundColor="White"
                               TextColor="#212529"/>
                    </VerticalStackLayout>
                    
                    <!-- Category Field -->
                    <VerticalStackLayout Spacing="5">
                        <Label Text="Category" 
                               FontSize="14" 
                               FontAttributes="Bold" 
                               TextColor="#495057"/>
                        <Picker SelectedItem="{Binding Item.Category}"
                                Title="Select category"
                                BackgroundColor="White"
                                TextColor="#212529">
                            <Picker.ItemsSource>
                                <x:Array Type="{x:Type x:String}">
                                    <x:String>Electronics</x:String>
                                    <x:String>Services</x:String>
                                    <x:String>Food</x:String>
                                    <x:String>General</x:String>
                                    <x:String>Entertainment</x:String>
                                    <x:String>Health</x:String>
                                    <x:String>Education</x:String>
                                </x:Array>
                            </Picker.ItemsSource>
                        </Picker>
                    </VerticalStackLayout>
                    
                    <!-- Rating Field -->
                    <VerticalStackLayout Spacing="5">
                        <Label Text="Rating *" 
                               FontSize="14" 
                               FontAttributes="Bold" 
                               TextColor="#495057"/>
                        <HorizontalStackLayout Spacing="10" HorizontalOptions="Center">
                            <Button Text="⭐" 
                                    Command="{Binding SetRatingCommand}"
                                    CommandParameter="1"
                                    BackgroundColor="{Binding Item.Rating, Converter={StaticResource RatingToColorConverter}, ConverterParameter=1}"
                                    TextColor="White"
                                    WidthRequest="40"
                                    HeightRequest="40"
                                    CornerRadius="20"/>
                            <Button Text="⭐" 
                                    Command="{Binding SetRatingCommand}"
                                    CommandParameter="2"
                                    BackgroundColor="{Binding Item.Rating, Converter={StaticResource RatingToColorConverter}, ConverterParameter=2}"
                                    TextColor="White"
                                    WidthRequest="40"
                                    HeightRequest="40"
                                    CornerRadius="20"/>
                            <Button Text="⭐" 
                                    Command="{Binding SetRatingCommand}"
                                    CommandParameter="3"
                                    BackgroundColor="{Binding Item.Rating, Converter={StaticResource RatingToColorConverter}, ConverterParameter=3}"
                                    TextColor="White"
                                    WidthRequest="40"
                                    HeightRequest="40"
                                    CornerRadius="20"/>
                            <Button Text="⭐" 
                                    Command="{Binding SetRatingCommand}"
                                    CommandParameter="4"
                                    BackgroundColor="{Binding Item.Rating, Converter={StaticResource RatingToColorConverter}, ConverterParameter=4}"
                                    TextColor="White"
                                    WidthRequest="40"
                                    HeightRequest="40"
                                    CornerRadius="20"/>
                            <Button Text="⭐" 
                                    Command="{Binding SetRatingCommand}"
                                    CommandParameter="5"
                                    BackgroundColor="{Binding Item.Rating, Converter={StaticResource RatingToColorConverter}, ConverterParameter=5}"
                                    TextColor="White"
                                    WidthRequest="40"
                                    HeightRequest="40"
                                    CornerRadius="20"/>
                        </HorizontalStackLayout>
                        <Label Text="{Binding Item.Rating, StringFormat='Selected Rating: {0}'}" 
                               FontSize="12" 
                               HorizontalOptions="Center" 
                               TextColor="#6C757D"/>
                    </VerticalStackLayout>
                    
                    <!-- Description Field -->
                    <VerticalStackLayout Spacing="5">
                        <Label Text="Description" 
                               FontSize="14" 
                               FontAttributes="Bold" 
                               TextColor="#495057"/>
                        <Editor Text="{Binding Item.Description}" 
                                Placeholder="Enter description"
                                BackgroundColor="White"
                                TextColor="#212529"
                                AutoSize="TextChanges"
                                HeightRequest="100"/>
                    </VerticalStackLayout>
                    
                </VerticalStackLayout>
            </Frame>
            
            <!-- Action Buttons -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                <Button Grid.Column="0" 
                        Text="Cancel" 
                        Command="{Binding CancelCommand}"
                        BackgroundColor="#6C757D"
                        TextColor="White"
                        HeightRequest="50"
                        CornerRadius="10"/>
                
                <Button Grid.Column="1" 
                        Text="{Binding IsEditing, Converter={StaticResource EditSaveConverter}}"
                        Command="{Binding SaveItemCommand}"
                        BackgroundColor="#FF3E3EB"
                        TextColor="White"
                        HeightRequest="50"
                        CornerRadius="10"/>
            </Grid>
            
            <!-- Loading Indicator -->
            <ActivityIndicator IsVisible="{Binding IsBusy}"
                              IsRunning="{Binding IsBusy}"
                              HorizontalOptions="Center"
                              Color="#FF3E3EB"/>
            
        </VerticalStackLayout>
    </ScrollView>
    
</ContentPage>